<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>City Miner ‚Äî CityCoin (CTC) Economy Demo</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#070a12; --neon1:#06b6d4; --neon2:#7c3aed; --card: rgba(255,255,255,0.04);
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:Inter,system-ui,Arial; background: linear-gradient(180deg,#061226 0%, #08142a 60%); color:#e6eef8}
  .wrap{max-width:940px; margin:18px auto; padding:18px; border-radius:14px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); box-shadow: 0 20px 60px rgba(0,0,0,0.6); border:1px solid rgba(255,255,255,0.02)}
  header{display:flex; justify-content:space-between; align-items:center; gap:12px}
  .brand{display:flex; gap:12px; align-items:center}
  .logo{width:56px; height:56px; border-radius:12px; background:linear-gradient(135deg,var(--neon1),var(--neon2)); display:flex; align-items:center; justify-content:center; font-weight:800; color:#02121a; box-shadow:0 8px 30px rgba(7,22,34,0.6)}
  h1{margin:0; font-size:20px}
  .sub{font-size:12px; opacity:0.85}
  .balances{display:flex; gap:10px; align-items:center}
  .bal{background:var(--card); padding:8px 12px; border-radius:999px; font-weight:700; font-size:14px}
  nav{display:flex; gap:8px; margin-top:14px}
  .tab{padding:10px 14px; border-radius:10px; background:rgba(255,255,255,0.02); cursor:pointer; font-weight:600}
  .tab.active{box-shadow:0 10px 30px rgba(7,22,34,0.6); border:1px solid rgba(255,255,255,0.03); background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01))}
  main{display:grid; grid-template-columns: 1fr 320px; gap:16px; margin-top:18px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:16px; border-radius:12px; border:1px solid rgba(255,255,255,0.02);}
  .section-title{font-weight:700; margin-bottom:8px}
  .city-illustration{height:220px; border-radius:10px; background:
    radial-gradient(circle at 85% 15%, rgba(255,255,255,0.04), transparent 6%),
    linear-gradient(180deg,#020618 0%, #08203a 60%);
    display:flex; align-items:flex-end; justify-content:center; padding:18px; position:relative; overflow:hidden}
  .city-illustration::after{content:''; position:absolute; left:0; right:0; bottom:0; height:60px; background:linear-gradient(180deg, transparent, rgba(0,0,0,0.6));}
  .city-sky{position:absolute; left:20px; top:20px; width:86px; height:86px; border-radius:50%; background: radial-gradient(circle at 30% 30%, #fff2b3, #ffd87a, #d6b24a); opacity:0.9}
  .building{width:60px; height:80px; margin:0 6px; background:linear-gradient(180deg,#0f1720,#06101b); border-radius:6px; box-shadow: inset 0 10px 18px rgba(255,255,255,0.02)}
  .neon{box-shadow:0 8px 24px rgba(7,22,34,0.6), 0 0 18px rgba(7,182,212,0.12)}
  .controls{display:flex; gap:8px; margin-top:12px}
  button.btn{padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; border: none}
  .btn.primary{background:linear-gradient(90deg,var(--neon1),var(--neon2)); color:#07121a}
  .btn.ghost{background:transparent; border:1px solid rgba(255,255,255,0.04); color:#e6eef8}
  .small{font-size:13px; opacity:0.9}
  .miner-list{display:flex; flex-direction:column; gap:10px}
  .miner{display:flex; align-items:center; justify-content:space-between; padding:10px; border-radius:10px; background:rgba(255,255,255,0.01); border:1px solid rgba(255,255,255,0.02)}
  .muted{opacity:0.8; font-size:13px}
  .stat-row{display:flex; gap:10px; flex-wrap:wrap; margin-top:8px}
  input[type="number"]{padding:8px 10px; border-radius:8px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); color:#e6eef8}
  .market-row{display:flex; gap:8px; align-items:center; margin-top:8px}
  .notice{font-size:13px; opacity:0.85; margin-top:10px}
  footer{margin-top:12px; font-size:12px; opacity:0.7}
  ol{padding-left:18px; margin:0}
  /* responsive */
  @media (max-width:900px){ main{grid-template-columns:1fr; } .city-illustration{height:160px} }
</style>
</head>
<body>
  <div class="wrap" role="application" aria-labelledby="title">
    <header>
      <div class="brand">
        <div class="logo">C</div>
        <div>
          <h1 id="title">City Miner ‚Äî CityCoin (CTC)</h1>
          <div class="sub">–ú–∞–π–Ω—ñ–Ω–≥, —Ä–∏–Ω–æ–∫ —ñ –µ–∫–æ–Ω–æ–º—ñ–∫–∞ ‚Äî –¥–µ–º–æ –ª–æ–∫–∞–ª—å–Ω–æ</div>
        </div>
      </div>

      <div class="balances">
        <div class="bal" id="tonBalance">TON: 0.000</div>
        <div class="bal" id="ctcBalance">CTC: 0</div>
      </div>
    </header>

    <nav>
      <div class="tab active" data-tab="city">üèô –ú—ñ—Å—Ç–æ (–ú–∞–π–Ω–µ—Ä–∏)</div>
      <div class="tab" data-tab="bank">üí∞ –ë–∞–Ω–∫ (–û–±–º—ñ–Ω)</div>
      <div class="tab" data-tab="market">üìà –†–∏–Ω–æ–∫ (–ê–ø–≥—Ä–µ–π–¥–∏)</div>
      <div class="tab" data-tab="friends">üë• –î—Ä—É–∑—ñ</div>
      <div class="tab" data-tab="ledger">üìí –ñ—É—Ä–Ω–∞–ª</div>
    </nav>

    <main>
      <section class="card">
        <div class="city-illustration">
          <div class="city-sky" aria-hidden="true"></div>
          <div style="display:flex; gap:6px; position:relative; z-index:2;">
            <div class="building"></div>
            <div class="building" style="height:110px"></div>
            <div class="building neon" style="height:140px"></div>
            <div class="building" style="height:90px"></div>
            <div class="building neon" style="height:130px"></div>
          </div>
        </div>

        <div id="tabCity" class="tabContent">
          <h3 class="section-title">–ú—ñ—Å—Ç–æ ‚Äî —Ç–≤–æ—ó –º–∞–π–Ω–µ—Ä–∏</h3>
          <div class="small muted">–ê–≤—Ç–æ–Ωa—Ä–∞—Ö—É–≤–∞–Ω–Ω—è CTC –≤—ñ–¥ –∫—É–ø–ª–µ–Ω–∏—Ö –º–∞–π–Ω–µ—Ä—ñ–≤. –ü–æ–∫–∞–∑–∞–Ω—ñ –ø—Ä–æ—î–∫—Ü—ñ—ó / –¥–æ–±–∞.</div>

          <div style="margin-top:12px" class="stat-row">
            <div class="muted">–ö—É—Ä—Å: <strong id="rateTxt">1 TON = 1,000,000 CTC</strong></div>
            <div class="muted">–ö–æ–º—ñ—Å—ñ—è –æ–±–º—ñ–Ω—É: <strong id="feePct">1%</strong></div>
            <div class="muted">CTC ‚Üí TON –ø—Ä–∏–∫–ª–∞–¥: <strong>100 CTC = 0.000100 TON</strong></div>
          </div>

          <div style="margin-top:12px">
            <div class="miner-list" id="minerList"></div>
          </div>

          <div class="controls" style="margin-top:10px">
            <button class="btn primary" id="addClick">–ö–ª—ñ–∫–Ω—É—Ç–∏ ‚Äî –æ—Ç—Ä–∏–º–∞—Ç–∏ 1 CTC</button>
            <button class="btn ghost" id="collectAll">–ó—ñ–±—Ä–∞—Ç–∏ CTC –∑ –º–∞–π–Ω–µ—Ä—ñ–≤</button>
            <div style="margin-left:auto" class="muted small">–ü—Ä–æ—î–∫—Ü—ñ—è: <span id="projCtcDay">0</span> CTC / –¥–µ–Ω—å (~<span id="projTonDay">0.000</span> TON/–¥)</div>
          </div>

          <div class="notice">–ü–æ—è—Å–Ω–µ–Ω–Ω—è –µ–∫–æ–Ω–æ–º—ñ–∫–∏: –º–∏ –≤—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ —Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–π –∫—É—Ä—Å 1 TON = 1,000,000 CTC (—Ç–æ–±—Ç–æ 1 CTC = 0.000001 TON). –Ø–∫—â–æ –º–∞–π–Ω–∏—Ç—å—Å—è 100 CTC/–¥ ‚Äî —Ü–µ 0.0001 TON/–¥. –ê–ø–≥—Ä–µ–π–¥–∏ –ø—ñ–¥–≤–∏—â—É—é—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –º–∞–π–Ω–µ—Ä—ñ–≤.</div>
        </div>

        <div id="tabBank" class="tabContent" style="display:none">
          <h3 class="section-title">–ë–∞–Ω–∫ ‚Äî –æ–±–º—ñ–Ω</h3>
          <div class="small muted">–û–±–º—ñ–Ω—è–π CTC ‚Üí TON –∞–±–æ –∫—É–ø–∏ CTC –∑–∞ TON. –ö–æ–º—ñ—Å—ñ—è: <span id="feeInline">1%</span>.</div>

          <div style="margin-top:12px">
            <div class="market-row">
              <input id="sellCtcAmount" type="number" placeholder="CTC to sell" min="1" />
              <button class="btn primary" id="sellCtcBtn">–ü—Ä–æ–¥–∞—Ç–∏ CTC ‚Üí TON</button>
            </div>

            <div class="market-row">
              <input id="buyCtcAmount" type="number" placeholder="TON to spend" min="0.0001" step="0.0001" />
              <button class="btn primary" id="buyCtcBtn">–ö—É–ø–∏—Ç–∏ CTC –∑–∞ TON</button>
            </div>

            <div class="muted small" style="margin-top:8px" id="calcPreview"></div>
          </div>
        </div>

        <div id="tabMarket" class="tabContent" style="display:none">
          <h3 class="section-title">–†–∏–Ω–æ–∫ ‚Äî –∞–ø–≥—Ä–µ–π–¥–∏</h3>
          <div class="small muted">–ö—É–ø—É–π —Ç–∏–ø–∏ –º–∞–π–Ω–µ—Ä—ñ–≤ –¥–ª—è –∑–±—ñ–ª—å—à–µ–Ω–Ω—è CTC/–¥–æ–±—É. –í–∞—Ä—Ç—ñ—Å—Ç—å –≤ TON.</div>

          <div style="margin-top:12px" id="shopList"></div>
        </div>

        <div id="tabFriends" class="tabContent" style="display:none">
          <h3 class="section-title">–î—Ä—É–∑—ñ ‚Äî —Ä–µ—Ñ–µ—Ä–∞–ª–∏</h3>
          <div class="small muted">–í–≤–µ–¥–∏ –∫–æ–¥ –¥—Ä—É–≥–∞ –∞–±–æ –ø–æ–¥—ñ–ª–∏—Å—è —Å–≤–æ—ó–º. –ü—Ä–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –¥—Ä—É–≥–∞ –≤–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ –±–æ–Ω—É—Å.</div>

          <div style="margin-top:10px" class="market-row">
            <input id="refCode" placeholder="–ö–æ–¥ –¥—Ä—É–≥–∞" />
            <button class="btn ghost" id="applyRef">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
          </div>

          <div style="margin-top:10px" class="muted small">–¢–≤—ñ–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∏–π –∫–æ–¥: <strong id="myRef">...</strong></div>
        </div>

        <div id="tabLedger" class="tabContent" style="display:none">
          <h3 class="section-title">–ñ—É—Ä–Ω–∞–ª –¥—ñ–π</h3>
          <div class="small muted">–û–ø–µ—Ä–∞—Ü—ñ—ó –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ.</div>
          <ol id="ledgerList" style="margin-top:10px"></ol>
        </div>

      </section>

      <aside>
        <div class="card">
          <div class="section-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
          <div class="muted small">CTC –∑–∞–≥–∞–ª–æ–º: <div style="font-weight:800; font-size:18px" id="statCtcTotal">0</div></div>
          <div class="muted small" style="margin-top:8px">TON –∑–∞–≥–∞–ª–æ–º: <div style="font-weight:800; font-size:18px" id="statTonTotal">0.000</div></div>

          <div style="margin-top:12px">
            <div class="section-title">–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –µ–∫–æ–Ω–æ–º—ñ–∫–∏</div>
            <div class="muted small">–ö—É—Ä—Å: <strong id="rateShow">1 TON = 1,000,000 CTC</strong></div>
            <div class="muted small">CTC ‚Üí TON —Ñ–æ—Ä–º—É–ª–∞: TON = CTC √ó 0.000001</div>
            <div class="muted small" style="margin-top:6px">–ú–∞–π–Ω—ñ–Ω–≥: –Ω–∞–≥–æ—Ä–æ–¥–∞ –Ω–∞ –¥–æ–±—É (CTC) —Å—É–º—É—î—Ç—å—Å—è –∑ —É—Å—ñ—Ö –º–∞–π–Ω–µ—Ä—ñ–≤</div>
          </div>

          <div style="margin-top:12px">
            <div class="section-title">Request Payout (–¥–µ–º–æ)</div>
            <div class="muted small">–°—Ç–≤–æ—Ä—é—î –ª–æ–∫–∞–ª—å–Ω—É –∑–∞—è–≤–∫—É –Ω–∞ –≤–∏–≤—ñ–¥ TON (–ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ä–µ–∞–ª—å–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏).</div>
            <div style="margin-top:8px" class="market-row">
              <button class="btn ghost" id="requestPayout">Request Payout</button>
            </div>
          </div>

          <div style="margin-top:12px">
            <div class="section-title">–û—á–∏—Å—Ç–∏—Ç–∏ –¥–∞–Ω—ñ</div>
            <div class="muted small">–í–∏–¥–∞–ª–∏—Ç—å localStorage (–æ–±–µ—Ä–µ–∂–Ω–æ!)</div>
            <div style="margin-top:8px" class="market-row">
              <button class="btn ghost" id="resetBtn">Reset Local Data</button>
            </div>
          </div>
        </div>
      </aside>
    </main>

    <footer style="text-align:center; margin-top:14px; opacity:0.8; font-size:13px">
      Demo ‚Äî —Ä–µ–∞–ª—å–Ω—ñ –≤–∏–ø–ª–∞—Ç–∏ –≤–∏–º–∞–≥–∞—é—Ç—å —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é TonConnect/TonWeb —Ç–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏ KYC. –£—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –ª–æ–∫–∞–ª—å–Ω—ñ.
    </footer>
  </div>

<script>
/*
City Miner ‚Äî single-file economy demo
- Currency: CityCoin (CTC) and TON
- Exchange rate: 1 TON = 1,000,000 CTC  (so 1 CTC = 0.000001 TON)
- Miners produce CTC per day; production ticked per second
- All data saved in localStorage
*/

// ---------- ECONOMY CONSTANTS (change to tune)
const EXCHANGE_RATE = 1_000_000; // 1 TON = 1,000,000 CTC
const FEE_PCT = 1; // percent fee on exchange
const DAY_SECONDS = 86400;

// Miner catalogue (shop items)
// each has: id, title, tonCost, ctcPerDay
const SHOP = [
  { id: 'basic', title: 'Basic Miner', tonCost: 0.0005, ctcPerDay: 100 },   // 100 CTC/day ‚â° 0.0001 TON/day (100/1e6)
  { id: 'worker', title: 'Worker Node', tonCost: 0.002, ctcPerDay: 450 },   // 450 CTC/day
  { id: 'factory', title: 'Factory', tonCost: 0.01, ctcPerDay: 3000 },     // 3000 CTC/day
  { id: 'plant', title: 'Power Plant', tonCost: 0.05, ctcPerDay: 18000 }   // 18k CTC/day
];

// ---------- STORAGE KEYS
const KEY_STATE = 'cityminer_state_v1'; // keep everything in one object

// ---------- initial state
const defaultState = {
  ton: 0.005,       // starting TON for demo (give a tiny amount)
  ctc: 0,           // CityCoin balance
  miners: {},       // map id -> count
  ledger: [],       // list of actions
  payouts: [],      // payout requests
  refCode: null,    // user's ref code
  appliedRef: null, // code applied by user
  createdAt: new Date().toISOString()
};

// ---------- load / save
function loadState(){
  try{
    const raw = localStorage.getItem(KEY_STATE);
    if(!raw) return JSON.parse(JSON.stringify(defaultState));
    return JSON.parse(raw);
  }catch(e){
    console.error('load err', e);
    return JSON.parse(JSON.stringify(defaultState));
  }
}
function saveState(){
  localStorage.setItem(KEY_STATE, JSON.stringify(state));
}

// ---------- app state
let state = loadState();

// ensure ref code exists
if(!state.refCode){
  state.refCode = 'REF' + Math.random().toString(36).slice(2,9).toUpperCase();
  saveState();
}

// ---------- UI refs
const tonBalanceEl = document.getElementById('tonBalance');
const ctcBalanceEl = document.getElementById('ctcBalance');
const minerListEl = document.getElementById('minerList');
const shopListEl = document.getElementById('shopList');
const projCtcDayEl = document.getElementById('projCtcDay');
const projTonDayEl = document.getElementById('projTonDay');
const rateTxt = document.getElementById('rateTxt');
const feePct = document.getElementById('feePct');
const rateShow = document.getElementById('rateShow');
const statCtcTotal = document.getElementById('statCtcTotal');
const statTonTotal = document.getElementById('statTonTotal');
const ledgerList = document.getElementById('ledgerList');
const myRef = document.getElementById('myRef');
const calcPreview = document.getElementById('calcPreview');

// tabs
const tabs = document.querySelectorAll('.tab');
tabs.forEach(t => t.addEventListener('click', () => {
  tabs.forEach(x=>x.classList.remove('active'));
  t.classList.add('active');
  const tab = t.getAttribute('data-tab');
  document.querySelectorAll('.tabContent').forEach(c => c.style.display = c.id === 'tab' + capitalize(tab) ? '' : 'none');
}));

function capitalize(s){ return s.charAt(0).toUpperCase()+s.slice(1); }

// ---------- helpers for currency display
function formatTon(x){ return Number(x).toFixed(6).replace(/\.?0+$/,'') } // show up to 6 decimals, trim zeros
function formatCtc(n){ return Math.round(n) } // integer CTC for simplicity

// ---------- compute production
function totalCtcPerDay(){
  let sum = 0;
  SHOP.forEach(item=>{
    const cnt = state.miners[item.id] || 0;
    sum += cnt * item.ctcPerDay;
  });
  return sum;
}
function totalTonPerDay(){
  // CTC -> TON via EXCHANGE_RATE
  return totalCtcPerDay() / EXCHANGE_RATE;
}

// ---------- render UI
function renderAll(){
  tonBalanceEl.textContent = 'TON: ' + formatTon(state.ton);
  ctcBalanceEl.textContent = 'CTC: ' + formatCtc(state.ctc);
  rateTxt.textContent = `1 TON = ${EXCHANGE_RATE.toLocaleString()} CTC`;
  feePct.textContent = FEE_PCT + '%';
  rateShow.textContent = `1 TON = ${EXCHANGE_RATE.toLocaleString()} CTC`;
  statCtcTotal.textContent = formatCtc(state.ctc);
  statTonTotal.textContent = formatTon(state.ton);

  // miners panel
  minerListEl.innerHTML = '';
  SHOP.forEach(item=>{
    const cnt = state.miners[item.id] || 0;
    const row = document.createElement('div');
    row.className = 'miner';
    row.innerHTML = `
      <div>
        <div style="font-weight:700">${item.title}</div>
        <div class="muted small">–í–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ: <strong>${item.ctcPerDay}</strong> CTC/–¥–æ–±–∞ ‚Ä¢ –í–∞—Ä—Ç—ñ—Å—Ç—å: <strong>${item.tonCost} TON</strong></div>
      </div>
      <div style="display:flex; flex-direction:column; gap:6px; align-items:flex-end">
        <div class="muted small">–¢–≤—ñ–π: <strong>${cnt}</strong></div>
        <div style="display:flex; gap:6px">
          <button class="btn ghost buyMiner" data-id="${item.id}" data-mode="ton">–ö—É–ø–∏—Ç–∏ (TON)</button>
          <button class="btn ghost buyMiner" data-id="${item.id}" data-mode="ctc">–ö—É–ø–∏—Ç–∏ (CTC)</button>
        </div>
      </div>
    `;
    minerListEl.appendChild(row);
  });

  // shop list (same items, purchase by TON)
  shopListEl.innerHTML = '';
  SHOP.forEach(item=>{
    const el = document.createElement('div');
    el.style.marginBottom = '10px';
    el.innerHTML = `
      <div style="display:flex; justify-content:space-between; align-items:center">
        <div>
          <div style="font-weight:700">${item.title}</div>
          <div class="muted small">Produces ${item.ctcPerDay} CTC/day</div>
        </div>
        <div style="text-align:right">
          <div style="font-weight:800">${item.tonCost} TON</div>
          <button class="btn primary buyMiner" data-id="${item.id}" data-mode="ton" style="margin-top:6px">–ö—É–ø–∏—Ç–∏</button>
        </div>
      </div>`;
    shopListEl.appendChild(el);
  });

  // projection
  const totalDay = totalCtcPerDay();
  projCtcDayEl.textContent = formatCtc(totalDay);
  projTonDayEl.textContent = formatTon(totalDay / EXCHANGE_RATE);

  // ledger
  ledgerList.innerHTML = '';
  state.ledger.slice().reverse().slice(0,30).forEach(entry=>{
    const li = document.createElement('li');
    li.innerHTML = `<div style="font-weight:700">${entry.title}</div><div class="muted small">${entry.desc} ‚Ä¢ <span class="muted">${new Date(entry.ts).toLocaleString()}</span></div>`;
    ledgerList.appendChild(li);
  });

  myRef.textContent = state.refCode;
  saveState();
}

// ---------- actions
function addLedger(title, desc){
  state.ledger.push({ title, desc, ts: Date.now() });
  if(state.ledger.length > 500) state.ledger.shift();
  renderAll();
}

// buy miner (mode 'ton' or 'ctc')
function buyMiner(itemId, mode='ton'){
  const item = SHOP.find(s=>s.id===itemId);
  if(!item) return alert('–ù–µ–º–∞—î —Ç–∞–∫–æ–≥–æ –º–∞–π–Ω–µ—Ä–∞');
  if(mode === 'ton'){
    if(state.ton + 1e-12 < item.tonCost) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ TON');
    state.ton = Math.round((state.ton - item.tonCost) * 1e9)/1e9;
    state.miners[itemId] = (state.miners[itemId]||0) + 1;
    addLedger('–ö—É–ø–ª–µ–Ω–æ –º–∞–π–Ω–µ—Ä', `${item.title} –∑–∞ ${item.tonCost} TON`);
  } else {
    // buy with CTC: cost in CTC equivalent = item.tonCost * EXCHANGE_RATE
    const costCtc = Math.round(item.tonCost * EXCHANGE_RATE);
    if(state.ctc < costCtc) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ CTC');
    state.ctc -= costCtc;
    state.miners[itemId] = (state.miners[itemId]||0) + 1;
    addLedger('–ö—É–ø–ª–µ–Ω–æ –º–∞–π–Ω–µ—Ä (CTC)', `${item.title} –∑–∞ ${costCtc} CTC`);
  }
  renderAll();
}

// click reward (manual)
document.getElementById('addClick').addEventListener('click', () => {
  state.ctc += 1; // simple click reward
  addLedger('–ö–ª—ñ–∫', '–û—Ç—Ä–∏–º–∞–Ω–æ 1 CTC (–∫–ª—ñ–∫)');
  renderAll();
});

// collect from miners (force compute produced since last collect)
function collectFromMiners(){
  // We'll simulate that miners produce continuously; we store lastCollect timestamp
  const now = Date.now();
  if(!state.lastCollect) state.lastCollect = now;
  const elapsed = (now - state.lastCollect) / 1000; // seconds since last collect
  if(elapsed <= 0) return;
  const perSec = totalCtcPerDay() / DAY_SECONDS;
  const produced = perSec * elapsed;
  const add = Math.floor(produced); // whole CTC units
  if(add > 0){
    state.ctc += add;
    state.lastCollect = now;
    addLedger('–ó—ñ–±—Ä–∞–Ω–æ', `–û—Ç—Ä–∏–º–∞–Ω–æ ${add} CTC –≤—ñ–¥ –º–∞–π–Ω–µ—Ä—ñ–≤ (–∑–∞ ${Math.round(elapsed)} —Å)`);
  } else {
    state.lastCollect = now;
  }
  renderAll();
}
document.getElementById('collectAll').addEventListener('click', collectFromMiners);

// buy miner buttons
document.addEventListener('click', (e) => {
  const t = e.target;
  if(t.classList && t.classList.contains('buyMiner')){
    const id = t.getAttribute('data-id');
    const mode = t.getAttribute('data-mode') || 'ton';
    buyMiner(id, mode);
  }
});

// auto production tick (every second)
setInterval(() => {
  // calculate per-second production
  const perSec = totalCtcPerDay() / DAY_SECONDS;
  // accumulate fractional production
  state._frac = (state._frac || 0) + perSec;
  const add = Math.floor(state._frac);
  if(add >= 1){
    state.ctc += add;
    state._frac -= add;
    addLedger('–ê–≤—Ç–æ–ø—Ä–æ—Ü–µ—Å', `+${add
  
  
